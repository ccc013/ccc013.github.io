<!doctype html>



  


<html class="theme-next mist use-motion">
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Python - 实战 - 技术," />





  <link rel="alternate" href="/atom.xml" title="一个算法汪的日常" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/images/favicon/icon_code.jpg?v=5.0.1" />






<meta name="description" content="本文大约 1933 字，阅读大约需要  6 分钟

最近刚刚更换了公众号名字，然后自然就需要更换下文章末尾的二维码关注图，但是之前是通过 windows 自带的画图软件做的，但是之前弄的时候其实还是比较麻烦的，所以我就想作为一名程序猿，当然要努力用代码解决这个问题。
而且最近发现了一个新的图像处理方面的库—Wand，它是 ImageMagick 库的 Python 接口。于是，我就打算用这个库来实">
<meta property="og:type" content="article">
<meta property="og:title" content="[实战]制作简单的公众号二维码关注图">
<meta property="og:url" content="http://ccc013.github.io/2018/10/14/实战-制作简单的公众号二维码关注图/index.html">
<meta property="og:site_name" content="一个算法汪的日常">
<meta property="og:description" content="本文大约 1933 字，阅读大约需要  6 分钟

最近刚刚更换了公众号名字，然后自然就需要更换下文章末尾的二维码关注图，但是之前是通过 windows 自带的画图软件做的，但是之前弄的时候其实还是比较麻烦的，所以我就想作为一名程序猿，当然要努力用代码解决这个问题。
而且最近发现了一个新的图像处理方面的库—Wand，它是 ImageMagick 库的 Python 接口。于是，我就打算用这个库来实">
<meta property="og:image" content="https://cai-images-1257823952.cos.ap-beijing.myqcloud.com/qrcode_for_gh_207dddb4bd42_258.jpg">
<meta property="og:image" content="https://cai-images-1257823952.cos.ap-beijing.myqcloud.com/composition.jpg">
<meta property="og:image" content="https://cai-images-1257823952.cos.ap-beijing.myqcloud.com/qrcode_composition1.jpg">
<meta property="og:image" content="https://cai-images-1257823952.cos.ap-beijing.myqcloud.com/qrcode_new.jpg">
<meta property="og:image" content="https://cai-images-1257823952.cos.ap-beijing.myqcloud.com/qrcode_new.jpg">
<meta property="og:image" content="http://7xrluf.com1.z0.glb.clouddn.com/FrfgqfXz4Db6nVAfLwSVN_TG4Rsu">
<meta property="og:image" content="http://7xrluf.com1.z0.glb.clouddn.com/FvfhASK3XZvkXg7YCxvpvXXCpAS-">
<meta property="og:updated_time" content="2018-10-14T12:49:17.472Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="[实战]制作简单的公众号二维码关注图">
<meta name="twitter:description" content="本文大约 1933 字，阅读大约需要  6 分钟

最近刚刚更换了公众号名字，然后自然就需要更换下文章末尾的二维码关注图，但是之前是通过 windows 自带的画图软件做的，但是之前弄的时候其实还是比较麻烦的，所以我就想作为一名程序猿，当然要努力用代码解决这个问题。
而且最近发现了一个新的图像处理方面的库—Wand，它是 ImageMagick 库的 Python 接口。于是，我就打算用这个库来实">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Mist',
    sidebar: {"position":"right","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: undefined,
      author: '博主'
    }
  };
</script>

  <title> [实战]制作简单的公众号二维码关注图 | 一个算法汪的日常 </title><!-- hexo-inject:begin --><!-- hexo-inject:end -->
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  








  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div style="display: none;">
    <script src="http://s6.cnzz.com/stat.php?id=1257376919&web_id=1257376919" type="text/javascript"></script>
  </div>





  
  
    
  

  <div class="container one-collumn sidebar-position-right page-post-detail ">
    <div class="headband"></div>

    <!-- add Fork me on Github -->
    <a href="https://github.com/ccc013"><img style="position: absolute; top: 0; left: 0; border: 0;" src="https://camo.githubusercontent.com/82b228a3648bf44fc1163ef44c62fcc60081495e/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f6c6566745f7265645f6161303030302e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_left_red_aa0000.png"></a>

    <!--add Fork me on Github  -->
    
    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">一个算法汪的日常</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">Stay hungry, stay foolish</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-commonweal">
          <a href="/404.html" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-heartbeat"></i> <br />
            
            公益404
          </a>
        </li>
      

      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                [实战]制作简单的公众号二维码关注图
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2018-10-14T20:42:49+08:00" content="2018-10-14">
              2018-10-14
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2018/10/14/实战-制作简单的公众号二维码关注图/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2018/10/14/实战-制作简单的公众号二维码关注图/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          
             <span id="/2018/10/14/实战-制作简单的公众号二维码关注图/" class="leancloud_visitors" data-flag-title="[实战]制作简单的公众号二维码关注图">
               &nbsp; | &nbsp;
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">阅读次数 </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          
        
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <blockquote>
<p>本文大约 1933 字，阅读大约需要  6 分钟</p>
</blockquote>
<p>最近刚刚更换了公众号名字，然后自然就需要更换下文章末尾的二维码关注图，但是之前是通过 windows 自带的画图软件做的，但是之前弄的时候其实还是比较麻烦的，所以我就想作为一名程序猿，当然要努力用代码解决这个问题。</p>
<p>而且最近发现了一个新的图像处理方面的库—Wand，它是 ImageMagick 库的 Python 接口。于是，我就打算用这个库来实现简单的制作一个二维码关注图，主要是完成以下几个工作：</p>
<ol>
<li>制作一个白色的背景图；</li>
<li>将背景图和公众号二维码图合成；</li>
<li>添加文字得到最终的合成图</li>
</ol>
<h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><p>Wand 是基于 ctypes 库的适用于 Python 的 ImageMagick 的封装库。</p>
<p>相比其他对 ImageMagick 的封装库，Wand 有以下几个优势：</p>
<ol>
<li>符合 Python 习惯和现代化的接口</li>
<li>有好的文档</li>
<li>通过 ctypes 进行封装</li>
<li>可以采用 pip 安装</li>
</ol>
<h3 id="安装教程"><a href="#安装教程" class="headerlink" title="安装教程"></a>安装教程</h3><p>在 ubuntu下，可以直接按照下列命令安装：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ apt-get install libmagickwand-dev&#10;$ pip install Wand</span><br></pre></td></tr></table></figure>
<h4 id="安装要求"><a href="#安装要求" class="headerlink" title="安装要求"></a>安装要求</h4><p><strong>对 Python 版本要求：</strong></p>
<ul>
<li>Python 2.6+</li>
<li>CPython 2.6+</li>
<li>CPython 3.2+ or higher</li>
<li>PyPy 1.5+ or higher</li>
</ul>
<p><strong>MagickWand library</strong></p>
<ul>
<li>Debian/Ubuntu 系统：采用 apt-get 安装 libmagickwand-dev</li>
<li>Mac 系统：用 MacPorts/Homebrew 安装 imagemagick</li>
<li>CentOS 系统： 使用 yum 安装 ImageMagick-devel</li>
</ul>
<h4 id="Windows-注意事项"><a href="#Windows-注意事项" class="headerlink" title="Windows 注意事项"></a>Windows 注意事项</h4><p>主要还是参照第一篇文章来安装，并且主要是在 Windows 下安装，其中下载 ImageMagick 的时候，在<a href="http://www.imagemagick.org/download/binaries/" target="_blank" rel="external">下载地址</a>中需要选择 6.9版本的 dll 的 exe 执行文件安装，而不能选择最新版本的 7.0+，否则在 Python 中调用的时候，会出现问题<code>ImportError: MagickWand shared library not found.</code>，原因根据<a href="https://stackoverflow.com/questions/25003117/python-doesnt-find-magickwand-libraries-despite-correct-location" target="_blank" rel="external">Python doesn’t find MagickWand Libraries (despite correct location?)</a>中的说法是</p>
<blockquote>
<p>A few sources said that Image Magick 7.x is not compatible with magick Wand so make sure you’re using 6.x. Additionally, “static” suffix versions do not work. The one that finally worked for me was “ImageMagick-6.9.8-10-Q8-x64-dll.exe”</p>
</blockquote>
<p>也就是说  Image Magick 7.x 版本和 Wand 并不适配，所以只能采用 6+ 版本的。</p>
<h3 id="实战"><a href="#实战" class="headerlink" title="实战"></a>实战</h3><p>安装完成后，这里首先需要准备一张或者几张要合成的图片，比如作为背景的图片和前景图片，这里我是先给定大小来生成背景图片，而前景图片自然是我的公众号二维码图片了：</p>
<p><img src="https://cai-images-1257823952.cos.ap-beijing.myqcloud.com/qrcode_for_gh_207dddb4bd42_258.jpg" alt="公众号二维码"></p>
<p>首先是需要导入以下这些包：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> wand.image <span class="keyword">import</span> Image</span><br><span class="line"><span class="keyword">from</span> wand.drawing <span class="keyword">import</span> Drawing</span><br><span class="line"><span class="keyword">from</span> wand.color <span class="keyword">import</span> Color</span><br><span class="line"><span class="keyword">from</span> wand.display <span class="keyword">import</span> display</span><br></pre></td></tr></table></figure>
<h4 id="1-生成背景图片"><a href="#1-生成背景图片" class="headerlink" title="1. 生成背景图片"></a>1. 生成背景图片</h4><p>生成背景图片的代码如下所示：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 画一个纯白背景，并保存</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">draw_bg</span><span class="params">(self, width, height, filename=None, color=<span class="string">'white'</span>)</span>:</span></span><br><span class="line">    img = Image(width=width, height=height, background=Color(color))</span><br><span class="line">    <span class="keyword">if</span> filename <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">None</span>:</span><br><span class="line">        img.save(filename=filename)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> img</span><br></pre></td></tr></table></figure>
<p>这里就是根据传入的宽和高<code>width,height</code>，以及背景颜色<code>color</code>，生成指定大小和颜色的背景图片。</p>
<h4 id="2-将背景图和公众号二维码图合成"><a href="#2-将背景图和公众号二维码图合成" class="headerlink" title="2. 将背景图和公众号二维码图合成"></a>2. 将背景图和公众号二维码图合成</h4><p>接着就是合成图片的函数代码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 合成图片</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">composite_with_image</span><span class="params">(self, img_back, img, left, top, save_name=None, is_display=False)</span>:</span></span><br><span class="line">  draw = Drawing()</span><br><span class="line">  draw.composite(operator=<span class="string">'atop'</span>,</span><br><span class="line">                left=left, top=top,</span><br><span class="line">                width=img.width,</span><br><span class="line">                height=img.height,</span><br><span class="line">                image=img)</span><br><span class="line">  draw(img_back)</span><br><span class="line">  <span class="keyword">if</span> is_display:</span><br><span class="line">  	display(img_back)</span><br><span class="line">  <span class="keyword">if</span> save_name <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">None</span>:</span><br><span class="line">  	img_back.save(filename=save_name)</span><br><span class="line">  <span class="keyword">return</span> img_back</span><br><span class="line"><span class="comment"># 读取图片</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">read_image</span><span class="params">(self, image_name)</span>:</span></span><br><span class="line">  img = Image(filename=image_name)</span><br><span class="line">  print(<span class="string">'width='</span>, img.width)</span><br><span class="line">  print(<span class="string">'height='</span>, img.height)</span><br><span class="line">  print(<span class="string">'size='</span>, img.size)</span><br><span class="line">  <span class="keyword">return</span> img, img.width, img.height</span><br></pre></td></tr></table></figure>
<p>首先是用<code>read_image()</code>函数读取待合成的图片，然后利用<code>composite_with_image</code>函数来合成输入的两张图片，其中<code>img_back</code>表示背景图片，而<code>img</code>就是前景图片，<code>left, top</code>分别是前景图片在背景图片的左上角坐标位置。</p>
<p>这一步得到的结果如下所示，这里我设置的背景图片大小为：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">image_name = <span class="string">'qrcode.jpg'</span></span><br><span class="line">qrcode_img, width, height = read_image(images_name)</span><br><span class="line">bg_width = int(width * <span class="number">2.5</span>)</span><br><span class="line">bg_height = int(height * <span class="number">1.1</span>)</span><br></pre></td></tr></table></figure>
<p><img src="https://cai-images-1257823952.cos.ap-beijing.myqcloud.com/composition.jpg" alt="二维码和背景合成图"></p>
<h4 id="3-添加文字"><a href="#3-添加文字" class="headerlink" title="3. 添加文字"></a>3. 添加文字</h4><p>最后一步就是添加文字了，前面两步其实都非常简单，直接调用接口即可，但是添加文字的时候，却出现问题了。是什么问题呢？</p>
<p>首先先给出<code>wand</code>添加文字的代码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">draw_text</span><span class="params">(self, image, x, y, text, font_size=<span class="number">15</span>, font_style=<span class="string">'normal'</span>, text_alignment=<span class="string">'left'</span>,text_color=<span class="string">'Black'</span>, filename=None, is_display=False)</span>:</span></span><br><span class="line">    draw = Drawing()</span><br><span class="line">    draw.fill_color = Color(text_color)</span><br><span class="line">    draw.font_size = font_size</span><br><span class="line">    draw.font_style = font_style</span><br><span class="line">    draw.text_alignment = text_alignment</span><br><span class="line">    draw.text(x, y, text)</span><br><span class="line">    draw(image)</span><br><span class="line">    <span class="keyword">if</span> is_display:</span><br><span class="line">        display(image)</span><br><span class="line">    <span class="keyword">if</span> filename <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">None</span>:</span><br><span class="line">        image.save(filename=filename)</span><br><span class="line">    <span class="keyword">return</span> image</span><br></pre></td></tr></table></figure>
<p>刚刚说的问题，其实也是 Python 很常见的问题，就是如果使用到中文的字符串的问题，本来我认为也是编码问题，但是我发现设置一个只包含英文字符串，和包含有中文字符串的结果是这样的：</p>
<p><img src="https://cai-images-1257823952.cos.ap-beijing.myqcloud.com/qrcode_composition1.jpg" alt=""></p>
<p>代码如下所示：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">text1 = <span class="string">'Hello world'</span></span><br><span class="line">text2 = <span class="string">'wechat:机器学习与计算机视觉'</span></span><br><span class="line"> x = int(width * <span class="number">1.5</span>) + <span class="number">50</span></span><br><span class="line"> margin = <span class="number">60</span></span><br><span class="line">y2 = int(bg_height // <span class="number">2</span>)</span><br><span class="line">y1 = y2 - margin</span><br><span class="line">x1 = x2 = x + <span class="number">20</span></span><br><span class="line"></span><br><span class="line">result1 = draw_text(composite_images, x1, y1, text1, font_size=<span class="number">20</span>, text_color=<span class="string">'Gray'</span>, 			 text_alignment=<span class="string">'center'</span>, filename=<span class="string">'qrcode_composition.jpg'</span>, is_display=<span class="keyword">False</span>)</span><br><span class="line">result2 = draw_text(result1, x2, y2, text2, font_size=<span class="number">30</span>, text_color=<span class="string">'Black'</span>,</span><br><span class="line">                      text_alignment=<span class="string">'center'</span>,filename=<span class="string">'qrcode_composition.jpg'</span>,</span><br><span class="line">                                             is_display=<span class="keyword">False</span>)</span><br></pre></td></tr></table></figure>
<p>所以这应该不是编码问题，通过谷歌搜索后，发现应该是<code>wand</code>默认不支持中文字符的原因，接着在看到参考文章4后，我发现可以通过<code>wand.drawing.Drawing.font()</code>接口导入支持中文的字体来解决这个问题，而这些字体在哪里可以找到呢，其实在<code>c:\windows\fonts\</code>目录下面就可以找到了，宋体、微软雅黑的字体，只要指定字体路径即可，因此更新后的代码如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">FONT_DICT = &#123;<span class="string">'宋体'</span>: <span class="string">'songti.ttc'</span>,</span><br><span class="line">             <span class="string">'微软雅黑1'</span>: <span class="string">'msyh.ttc'</span>,</span><br><span class="line">             <span class="string">'微软雅黑2'</span>: <span class="string">'msyhbd.ttc'</span>,</span><br><span class="line">             <span class="string">'微软雅黑3'</span>: <span class="string">'msyhl.ttc'</span>&#125;</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">draw_text</span><span class="params">(self, image, x, y, text, font_size=<span class="number">15</span>, font_style=<span class="string">'normal'</span>,font=None,  text_alignment=<span class="string">'left'</span>,text_color=<span class="string">'Black'</span>, filename=None, is_display=False)</span>:</span></span><br><span class="line">    draw = Drawing()</span><br><span class="line"> 	<span class="keyword">if</span> font <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">None</span>:</span><br><span class="line">        draw.font = font</span><br><span class="line">    draw.fill_color = Color(text_color)</span><br><span class="line">    draw.font_size = font_size</span><br><span class="line">    draw.font_style = font_style</span><br><span class="line">    draw.text_alignment = text_alignment</span><br><span class="line">    draw.text(x, y, text)</span><br><span class="line">    draw(image)</span><br><span class="line">    <span class="keyword">if</span> is_display:</span><br><span class="line">        display(image)</span><br><span class="line">    <span class="keyword">if</span> filename <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">None</span>:</span><br><span class="line">        image.save(filename=filename)</span><br><span class="line">    <span class="keyword">return</span> image</span><br></pre></td></tr></table></figure>
<p>最终合成的结果如下：</p>
<p><img src="https://cai-images-1257823952.cos.ap-beijing.myqcloud.com/qrcode_new.jpg" alt=""></p>
<p>完整代码可以到我的Github上查看—<a href="https://github.com/ccc013/CodingPractise/blob/master/Python/Fun_Project/image_composition/image_composition.py" target="_blank" rel="external">image_composition.py</a></p>
<h3 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h3><p>这次的实战练习其实非常简单，唯一比较有困难的就是解决如何添加中文的文字了，但是还是非常实用的，熟练学会这个<code>Wand</code>后，就可以自己合成各种图片了，并且添加文字或者是其他图形等，具体可以查阅官方文档。</p>
<p>本文参考文章：</p>
<blockquote>
<ol>
<li><a href="http://docs.wand-py.org/en/0.4.2/guide/install.html" target="_blank" rel="external">Wand—Installtion</a></li>
<li><a href="http://www.imagemagick.org/script/index.php" target="_blank" rel="external">imagemagick home</a></li>
<li><a href="http://docs.wand-py.org/en/0.4.4/" target="_blank" rel="external">Wand Documentation</a></li>
<li><a href="http://touya.iteye.com/blog/251305" target="_blank" rel="external">用ImageMagick在图片中写中文的问题及解决</a></li>
<li><a href="https://stackoverflow.com/questions/30586447/python-wand-change-text-style-with-draw-text" target="_blank" rel="external">python-wand-change-text-style-with-draw-text</a></li>
</ol>
</blockquote>
<p>以上就是本文的主要内容和总结，欢迎留言给出你对本文的建议和看法。</p>
<p>同时也欢迎关注我的微信公众号—机器学习与计算机视觉或者扫描下方的二维码，和我分享你的建议和看法，指正文章中可能存在的错误，大家一起交流，学习和进步！</p>
<p><img src="https://cai-images-1257823952.cos.ap-beijing.myqcloud.com/qrcode_new.jpg" alt=""></p>
<p>如果你觉得我写得还不错，可以给我点个赞！</p>
<p><img src="http://7xrluf.com1.z0.glb.clouddn.com/FrfgqfXz4Db6nVAfLwSVN_TG4Rsu" alt=""></p>
<p><img src="http://7xrluf.com1.z0.glb.clouddn.com/FvfhASK3XZvkXg7YCxvpvXXCpAS-" alt=""></p>

      
    </div>

    <div>
      
        
      
    </div>

    <div>
      
        

      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Python-实战-技术/" rel="tag">#Python - 实战 - 技术</a>
          
        </div>
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2018/09/09/实战-四行代码生成一张素描图片/" rel="next" title="[实战]四行代码生成一张素描图片">
                <i class="fa fa-chevron-left"></i> [实战]四行代码生成一张素描图片
              </a>
            
          </div>

          <div class="post-nav-prev post-nav-item">
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
      <div id="lv-container" data-id="city" data-uid="MTAyMC8zOTcyOC8xNjI1NQ=="></div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/favicon.png"
               alt="cai" />
          <p class="site-author-name" itemprop="name">cai</p>
          <p class="site-description motion-element" itemprop="description"></p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">35</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">19</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/ccc013" target="_blank" title="Github">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  Github
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://weibo.com/u/2181051220?is_all=1" target="_blank" title="Weibo">
                  
                    <i class="fa fa-fw fa-weibo"></i>
                  
                  Weibo
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://www.zhihu.com/people/luo-cai" target="_blank" title="Zhihu">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  Zhihu
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://blog.csdn.net/lc013?viewmode=contents" target="_blank" title="CSDN">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  CSDN
                </a>
              </span>
            
          
        </div>

        
        
          <div class="cc-license motion-element" itemprop="license">
            <a href="http://creativecommons.org/licenses/by-nc-sa/4.0" class="cc-opacity" target="_blank">
              <img src="/images/cc-by-nc-sa.svg" alt="Creative Commons" />
            </a>
          </div>
        

        
        
          <div class="links-of-blogroll motion-element links-of-blogroll-inline">
            <div class="links-of-blogroll-title">
              <i class="fa  fa-fw fa-globe"></i>
              Links
            </div>
            <ul class="links-of-blogroll-list">
              
                <li class="links-of-blogroll-item">
                  <a href="http://blog.csdn.net/lmj623565791" title="张鸿洋的博客" target="_blank">张鸿洋的博客</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://blog.csdn.net/guolin_blog" title="郭霖的博客" target="_blank">郭霖的博客</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://blog.csdn.net/singwhatiwanna/article/category/1405419" title="任玉刚" target="_blank">任玉刚</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://blog.csdn.net/Luoshengyang/" title="罗升阳" target="_blank">罗升阳</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://hukai.me/" title="胡凯" target="_blank">胡凯</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://blog.daimajia.com/" title="代码家" target="_blank">代码家</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://hujiaweibujidao.github.io/" title="HujiaweiBujidao" target="_blank">HujiaweiBujidao</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://www.liaoxuefeng.com/" title="廖雪峰的博客" target="_blank">廖雪峰的博客</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="https://drakeet.me/" title="Drakeet的个人博客" target="_blank">Drakeet的个人博客</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://www.kymjs.com/" title="张涛-开源实验室" target="_blank">张涛-开源实验室</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://gudong.name/" title="咕咚" target="_blank">咕咚</a>
                </li>
              
            </ul>
          </div>
        

      </section>

      
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">
            
              
            
            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#简介"><span class="nav-number">1.</span> <span class="nav-text">简介</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#安装教程"><span class="nav-number">2.</span> <span class="nav-text">安装教程</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#安装要求"><span class="nav-number">2.1.</span> <span class="nav-text">安装要求</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Windows-注意事项"><span class="nav-number">2.2.</span> <span class="nav-text">Windows 注意事项</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#实战"><span class="nav-number">3.</span> <span class="nav-text">实战</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-生成背景图片"><span class="nav-number">3.1.</span> <span class="nav-text">1. 生成背景图片</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-将背景图和公众号二维码图合成"><span class="nav-number">3.2.</span> <span class="nav-text">2. 将背景图和公众号二维码图合成</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-添加文字"><span class="nav-number">3.3.</span> <span class="nav-text">3. 添加文字</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#小结"><span class="nav-number">4.</span> <span class="nav-text">小结</span></a></li></ol></div>
            
          </div>
        </section>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2015 - 
  <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">cai</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="http://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
  
</div>



        

<div class="busuanzi-count">

  <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv"><i class="fa fa-user"></i><span class="busuanzi-value" id="busuanzi_value_site_uv"></span></span>
  

  
    <span class="site-pv"><i class="fa fa-eye"></i><span class="busuanzi-value" id="busuanzi_value_site_pv"></span></span>
  
  
</div>



        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.1"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.0.1"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.0.1"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.1"></script>



  
  <script type="text/javascript">
    (function(d, s) {
      var j, e = d.getElementsByTagName(s)[0];
      if (typeof LivereTower === 'function') { return; }
      j = d.createElement(s);
      j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
      j.async = true;
      e.parentNode.insertBefore(j, e);
    })(document, 'script');
  </script>




  
  
  
  <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });
  </script>

  <script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
      var all = MathJax.Hub.getAllJax(), i;
      for (i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';
      }
    });
  </script>
  <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>


  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.1.js"></script>
  <script>AV.initialize("gmEY36PtfOmueA7roORTu2He-gzGzoHsz", "mzEkjGKehJYxfp1PrU0TYsW3");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script><!-- hexo-inject:begin --><!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({"tex2jax":{"inlineMath":[["$","$"],["\\(","\\)"]],"skipTags":["script","noscript","style","textarea","pre","code"],"processEscapes":true},"TeX":{"equationNumbers":{"autoNumber":"AMS"}}});
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js">
</script>
<!-- End: Injected MathJax -->
<!-- hexo-inject:end -->



  

</body>


<script type="text/javascript"
color="0,0,255" opacity='0.7' zIndex="-2" count="99" src="//cdn.bootcss.com/canvas-nest.js/1.0.0/canvas-nest.min.js"></script>



</html>
